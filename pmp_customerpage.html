<!DOCTYPE html>
<html lang="en">
<head>
</head>
    
<body>
    <script>
        
    </script>
    <h1 id="pagetitle"></h1>
    
    before the page is loaded, User specific JWT token to be generated to access Preference management app:<p>
    
    Customer: <input size=40 id="CustomerID" value="alexey.einor@usercentrics.com"><p>
    Private API key: <input  size=40 id="PrivateKey" value="3c3aa54d80d3af7fe7a119b4d282b7dde5287b096080e413b2ccf377c17e1a19"><p>
    End UserID:    <input  size=40 id="UserID" value="TestUser@domain.com"><p>
    <b><p id="custom_header">User Profile management page<p></b>
      
    <button onclick="callApi()"> Genereate token... </button>
    <p id="demo"></p>
    
    link to      PreferenceApp for current user: <a target=_blank id=pmplink href="">Please generate the token first</a>  
    <p align=center><img src=account_page.png></p>
</body>
<script>
    //const UserID = urlParams.get('UserID')
   // var UserID = location.href.split("UserID")[1]

                const params = new URLSearchParams(window. location. search)
           //     var UserID = params. get('UserID')
                var UserID = document.getElementById('UserID').value;
                var CustomerID = document.getElementById('CustomerID').value;
                var PrivateKey = document.getElementById('UserID').value
                // document.getElementById("custom_header").innerHTML = "UserID: "+ UserID;
                 //document.getElementById("pagetitle").innerHTML = " Profile management page for: "+ UserID;

    function callApi() {
        fetch("https://preference-api.preference-management.usercentrics-staging.eu/authenticate/user?userId=" +UserID+ "&customerId=" +CustomerID, {
            "headers": {
                "accept": "*/*",
                "accept-language": "en-GB,en-US;q=0.9,en;q=0.8,ru;q=0.7",
                "sec-ch-ua": "\"Google Chrome\";v=\"105\", \"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"105\"",
                "sec-ch-ua-mobile": "?0",
                "sec-ch-ua-platform": "\"macOS\"",
                "sec-fetch-dest": "empty",
                "sec-fetch-mode": "cors",
                "sec-fetch-site": "same-origin",
                "x-api-key": PrivateKey
            },
            "referrer": "https://preference-api.preference-management.usercentrics-staging.eu/api-doc/",
            "referrerPolicy": "strict-origin-when-cross-origin",
            "body": null,
            "method": "POST",
            "mode": "cors",
            "credentials": "include"
        }).then(r => r.json()).then(r => {
            document.getElementById("demo").innerHTML = r.token;
           document.getElementById("pmplink").href = "https://app-preference.preference-management.usercentrics-staging.eu/?widgets=2aab050c-ba4f-4df6-8450-fe313192b76b,0c49052e-17bb-49b0-83bd-275bbf70bfd7&token="+r.token+"";
             document.getElementById("pmplink").innerHTML = "ready!";
            
        });
    }
</script>
</html>
